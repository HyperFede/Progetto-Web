<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dettaglio Prodotto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/pages/modifcaProdotto.css">
</head>
<body>
    <header class="py-3 mb-4 border-bottom d-none d-lg-block custom-header">
        <div class="container d-flex flex-wrap justify-content-between align-items-center">
            <img src="assets/Logo.svg" alt="Logo" class="me-2" style="height: 80px;">

            <ul class="nav nav-pills align-items-center">
                <li class="nav-item dropdown">
                    <a class="nav-link nav-link-custom dropdown-toggle" href="#" id="userAccountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle fs-3 me-2"></i> Username
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userAccountDropdown">
                        <li><a class="dropdown-item" href="dashboardArtigiano.html"><i class="bi bi-person-workspace me-2"></i>IL MIO PROFILO</a></li>
                        <li><a class="dropdown-item" href="prodottiArtigiano.html"><i class="bi bi-box2-heart-fill me-2"></i>I MIEI PRODOTTI</a></li>
                        <li><a class="dropdown-item" href="ordiniRicevuti.html"><i class="bi bi-receipt-cutoff me-2"></i>ORDINI RICEVUTI</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-flag-fill me-2"></i>LE MIE SEGNALAZIONI</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>LOGOUT</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a href="aggiungiProdotto.html" class="btn add-product-btn">
                        <i class="bi bi-plus-circle-fill me-1"></i> Inserisci Prodotto
                    </a>
                </li>
            </ul>
        </div>
    </header>

    <!-- Navbar per schermi < lg -->
    <nav class="py-3 navbar bg-body-tertiary fixed-top d-lg-none">
         <div class="container-fluid d-flex justify-content-between align-items-center">
            <button class="navbar-toggler me-auto" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <img src="assets/Logo.svg" alt="Logo" class="me-2" style="height: 80px;">

            <div class="ms-auto"></div>
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Dashboard Artigiano</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                     <div class="dashboard-sidebar-offcanvas d-flex flex-column h-100">
                        <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboardArtigiano.html">
                                <i class="bi bi-person-workspace me-2"></i>IL MIO PROFILO
                            </a>
                        </li>
                        <li class="nav-item">
                             <a class="nav-link" aria-current="page" href="prodottiArtigiano.html"> <i class="bi bi-box2-heart-fill me-2"></i>I MIEI PRODOTTI
                             </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="ordiniRicevuti.html"> <i class="bi bi-receipt-cutoff me-2"></i>ORDINI RICEVUTI
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#"> <i class="bi bi-flag-fill me-2"></i>SEGNALAZIONI
                            </a>
                        </li>
                        </ul>
                        <hr class="sidebar-divider">
                        <button class="btn logout-btn w-100">
                            <i class="bi bi-box-arrow-right me-2"></i>LOGOUT
                        </button>
                    </div>
                </div>
            </div>
           <ul class="nav nav-pills align-items-center">
                <li class="nav-item">
                    <a href="aggiungiProdotto.html" class="btn add-product-btn">
                        <i class="bi bi-plus-circle-fill"></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <main class="container my-4 pt-lg-0">
        <div class="row mb-3">
            <div class="col">
                <a href="prodottiArtigiano.html" class="back-to-search-link">
                    <i class="bi bi-arrow-left-circle me-1"></i>
                    Torna ai prodotti
                </a>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6 mb-3 mb-md-0">
                <div class="product-detail-image-container position-relative product-detail-image-placeholder">
                    <!-- Contenitore per l'immagine o il testo placeholder -->
                    <div class="current-image-display d-flex align-items-center justify-content-center w-100 h-100">
                        <!-- Se c'è un'immagine caricata, verrà inserita qui dal JS. Esempio: -->
                        <!-- <img src="path/to/actual-image.jpg" alt="Immagine Prodotto" class="img-fluid"> -->
                        <!-- Altrimenti, il testo placeholder di default: -->
                        <span>IMG</span>
                    </div>

                    <!-- Overlay con icona cestino (mostrato su hover sull'immagine) -->
                    <div class="image-action-overlay position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background-color: rgba(0, 0, 0, 0.4); display: none; cursor: default;">
                        <button type="button" class="btn btn-danger btn-remove-image" title="Rimuovi immagine">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>

                    <!-- Bottone/Icona per aggiungere immagine (mostrato quando non c'è immagine) -->
                    <div class="add-image-trigger d-flex flex-column align-items-center justify-content-center w-100 h-100" style="cursor: pointer; display: none;">
                        <i class="bi bi-camera-fill fs-1 text-muted"></i>
                        <span class="text-muted mt-2">Aggiungi Immagine</span>
                        <input type="file" class="d-none" id="productImageInput" accept="image/*">
                    </div>
                </div>
            </div>

            <div class="col-md-6 product-details-column">
                <div class="mb-3">
                    <h5 class="mb-2">Categoria</h5>
                    <select class="form-select dashboard-input" id="productCategory" name="category" required>
                        <option selected disabled value="">Scegli una categoria...</option>
                        <option value="cat1">Categoria A</option>
                        <option value="cat2">Categoria B</option>
                        <option value="cat3">Categoria C</option>
                    </select>
                </div>
                <div class="mb-3">
                    <h5 class="mb-2">Nome Prodotto</h5>
                    <input type="text" class="form-control dashboard-input" id="productName" name="productName" required>
                </div>
                <div class="col-md-6">
                    <h5 class="mb-2">Prezzo(€)</h5>
                    <input type="number" class="form-control dashboard-input" id="productPrice" name="price" min="0" step="0.01"
                        required placeholder="">
                </div>

                <div class="product-rating-detail mb-2 mt-4">
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-fill"></i>
                    <i class="bi bi-star-half"></i>
                    <i class="bi bi-star"></i>
                    <span class="ms-1 text-muted">(N. Valutazioni)</span>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-12">
                <div class="product-description-box">
                    <h5 class="mb-2">Descrizione Prodotto</h5>
                    <div class="mb-3">
                        <textarea class="form-control dashboard-input" id="productDescription" name="description" rows="5"
                            required></textarea>
                    </div>
                </div>
            </div>
        </div>

        <hr class="my-4">
        
        <div class="row mb-5">
            <div class="col-12">
                <h3 class="customer-reviews-title mb-4">Recensioni dei clienti</h3>

                <div class="customer-review-box mb-3">
                    <div class="review-header d-flex justify-content-between align-items-center mb-1">
                        <span class="review-customer-name">Mario Rossi</span>
                        <span class="review-date">20/05/2025 10:30</span>
                    </div>
                    <div class="review-rating-title d-flex align-items-center mb-2">
                        <span class="review-stars me-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star"></i>
                        </span>
                        <strong class="review-object">Prodotto eccellente!</strong>
                    </div>
                    <div class="review-body d-flex align-items-start">
                        <div class="review-image-container me-3">
                            <img src="https://via.placeholder.com/120x120?text=IMG+Utente" alt="Foto recensione cliente" class="review-customer-photo">
                        </div>
                        <div class="review-text-content flex-grow-1">
                            <p class="review-text">
                                Questa è una prova di recensione! Questo è il primo formato!
                            </p>
                        </div>
                    </div>
                </div>
                <div class="customer-review-box mb-3">
                    <div class="review-header d-flex justify-content-between align-items-center mb-1">
                        <span class="review-customer-name">Laura Bianchi</span>
                        <span class="review-date">18/05/2025 15:45</span>
                    </div>
                    <div class="review-rating-title d-flex align-items-center mb-2">
                        <span class="review-stars me-2">
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                            <i class="bi bi-star-fill"></i>
                        </span>
                        <strong class="review-object">Ottimo acquisto</strong>
                    </div>
                    <div class="review-body">
                        <div class="review-text-content">
                            <p class="review-text">
                                Anche senza allegare foto, posso confermare che il prodotto è esattamente come descritto.
                                Funziona benissimo e risponde a tutte le mie esigenze. Lo ricomprerei sicuramente. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <button class="btn add-to-cart-button-detail d-flex justify-content-center align-items-center fixed-bottom-save-button">
                salva cambiamenti
        </button>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>document.addEventListener('DOMContentLoaded', () => {
    const imageContainer = document.querySelector('.product-detail-image-container');
    if (!imageContainer) return;

    const currentImageDisplay = imageContainer.querySelector('.current-image-display');
    const imageActionOverlay = imageContainer.querySelector('.image-action-overlay');
    const btnRemoveImage = imageContainer.querySelector('.btn-remove-image');
    const addImageTrigger = imageContainer.querySelector('.add-image-trigger');
    const productImageInput = imageContainer.querySelector('#productImageInput');

    // Funzione per aggiornare lo stato dell'interfaccia immagine
    function updateImageUI(hasImage) {
        if (hasImage) {
            currentImageDisplay.style.display = 'flex';
            addImageTrigger.style.display = 'none';
            imageContainer.classList.remove('state-add-image');
            imageActionOverlay.classList.add('can-delete'); // Permette all'hover CSS di mostrare il cestino
        } else {
            currentImageDisplay.style.display = 'none';
            addImageTrigger.style.display = 'flex';
            imageContainer.classList.add('state-add-image');
            imageActionOverlay.classList.remove('can-delete');
            // Assicura che l'overlay sia effettivamente nascosto quando non c'è immagine
            imageActionOverlay.style.display = 'none';
            imageActionOverlay.style.opacity = '0';
        }
    }

    // Controlla lo stato iniziale:
    // Se currentImageDisplay contiene un tag <img> con un src, consideriamo che ci sia un'immagine.
    // Altrimenti (se c'è solo lo span "IMG"), consideriamo che non ci sia un'immagine caricata.
    let initialImageElement = currentImageDisplay.querySelector('img');
    let hasInitialImage = initialImageElement && initialImageElement.getAttribute('src') && initialImageElement.getAttribute('src') !== '' && initialImageElement.getAttribute('src') !== '#';

    // Se non c'è un tag <img> ma solo lo span "IMG", allora non c'è una vera immagine.
    if (!initialImageElement && currentImageDisplay.querySelector('span')?.textContent === 'IMG') {
        hasInitialImage = false;
    }
    updateImageUI(hasInitialImage);


    // Evento per rimuovere l'immagine
    if (btnRemoveImage) {
        btnRemoveImage.addEventListener('click', () => {
            currentImageDisplay.innerHTML = '<span>IMG</span>'; // Ripristina il placeholder testuale
            productImageInput.value = ''; // Resetta l'input file
            updateImageUI(false);
            // Qui dovresti anche inviare un segnale al backend o aggiornare un campo form nascosto
            // per indicare che l'immagine è stata rimossa, se necessario per il salvataggio.
        });
    }

    // Evento per triggerare l'input file quando si clicca sul placeholder di aggiunta
    if (addImageTrigger) {
        addImageTrigger.addEventListener('click', () => {
            productImageInput.click();
        });
    }

    // Evento quando un file viene selezionato tramite l'input
    if (productImageInput) {
        productImageInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    // Mostra l'anteprima della nuova immagine
                    currentImageDisplay.innerHTML = `<img src="${e.target.result}" alt="Anteprima Prodotto">`;
                    updateImageUI(true);
                }
                reader.readAsDataURL(file);
            } else {
                // Se l'utente annulla la selezione del file, e non c'era un'immagine prima,
                // assicurati che la UI rifletta lo stato "nessuna immagine".
                // Questo scenario è più complesso se si vuole tornare a un'immagine precedente non salvata.
                // Per semplicità, se annulla, e non c'è un'immagine "salvata", si torna a "IMG".
                if (!currentImageDisplay.querySelector('img[src], img[data-existing-src]')) {
                     currentImageDisplay.innerHTML = '<span>IMG</span>';
                     updateImageUI(false);
                }
            }
        });
    }
});
</script>
</body>
</html>
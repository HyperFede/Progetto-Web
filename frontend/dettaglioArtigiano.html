<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vetrina Artigiano</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/pages/dettaglioArtigiano.css">
</head>
<body>
    <header class="py-3 mb-4 border-bottom d-none d-lg-block custom-header">
        <div class="container d-flex flex-wrap justify-content-between align-items-center">
            <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none">
                <img src="assets/Logo.svg" alt="Logo" class="me-2" style="height: 80px;">
            </a>

            <ul class="nav nav-pills align-items-center">
                <li class="nav-item dropdown invisible">
                    <a class="nav-link dropdown-toggle" href="#" id="userAccountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: var(--secondary-color);">
                        <i class="bi bi-person-circle fs-3 me-2"></i> <span id="nav-username">Username</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userAccountDropdown">
                        <li><a class="dropdown-item" href="dashboardUtente.html"><i class="bi bi-person-fill me-2"></i>IL MIO PROFILO</a></li>
                        <li><a class="dropdown-item" href="dashboardStoricoOrdini.html"><i class="bi bi-box-seam-fill me-2"></i>I MIEI ORDINI</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-flag-fill me-2"></i>LE MIE SEGNALAZIONI</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="logout.html"><i class="bi bi-box-arrow-right me-2"></i>LOGOUT</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown invisible-admin">
                    <a class="nav-link dropdown-toggle" href="#" id="userAccountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: var(--secondary-color);">
                        <i class="bi bi-person-circle fs-3 me-2"></i> <span id="nav-username">Username</span>
                    </a>
                    <!-- ADMIN -->
                    <ul class="invisible-admin dropdown-menu dropdown-menu-end" aria-labelledby="userAccountDropdown">
                        <li><a class="dropdown-item" href="dashboardAdmin.html"><i class="bi bi-person-fill me-2"></i>ACCETTAZIONE</a></li>
                        <li><a class="dropdown-item" href="gestione.html"><i class="bi bi-box-seam-fill me-2"></i>GESTIONE SEGNALAZIONE</a></li>
                        <li><a class="dropdown-item" href="logout.html"><i class="bi bi-flag-fill me-2"></i>LOGOUT</a></li>
                    </ul>
                    <!-- FINE -->
                </li>
                <!-- UNLOGGED -->
                <li class="nav-item unlogged"><a href="login.html" class="nav-link" style="color: var(--secondary-color);">ACCEDI</a></li>
                <li class="nav-item unlogged" style="color: var(--secondary-color)">|</li>
                <li class="nav-item unlogged"><a href="registrati.html" class="nav-link" style="color: var(--secondary-color);">REGISTRATI</a></li>
                <!--FINE-->
                <li class="nav-item">
                    <!-- UNLOGGED -->
                    <a href="login.html" class="nav-link unlogged" style="color: var(--secondary-color);">
                        <i class="bi bi-cart fs-4"></i>
                    </a>
                    <!--FINE-->
                    <a href="carrelloUtente.html" class="nav-link invisible" style="color: var(--secondary-color);">
                        <i class="bi bi-cart fs-3"></i>
                    </a>
                </li>
            </ul>
        </div>
    </header>

<!-- Navbar per schermi < lg -->
    <nav class="py-3 navbar bg-body-tertiary fixed-top d-lg-none"> <!-- Mantenuto fixed-top come richiesto in precedenza -->
         <div class="container-fluid d-flex justify-content-between align-items-center">
            <button class="navbar-toggler me-auto" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
                <img src="assets/Logo.svg" alt="Logo" class="me-2" style="height: 80px;">
            </a>

            <div class="ms-auto"></div> <!-- Spacer to push toggler and logo to the left -->

            <!-- Offcanvas UNLOGGED -->
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header unlogged">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menù</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body unlogged">
                    <div class="dashboard-sidebar-offcanvas d-flex flex-column h-100">
                        <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="login.html">
                                <i class="bi bi-person-fill me-2"></i>ACCEDI
                            </a>
                        </li>
                        <li class="nav-item">
                             <a class="nav-link active" aria-current="page" href="registrati.html"> <i class="bi bi-pencil-square me-2"></i>REGISTRATI
                             </a>
                        </li>
                        </ul>
                    </div>
                </div>

                <!-- Offcanvas menu LOGGED-->
                <div class="offcanvas-header invisible">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Il Mio Account</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body invisible">
                     <div class="dashboard-sidebar-offcanvas d-flex flex-column h-100">
                        <ul class="nav nav-pills flex-column mb-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboardUtente.html">
                                <i class="bi bi-person-fill me-2"></i>IL MIO PROFILO
                            </a>
                        </li>
                        <li class="nav-item">
                             <a class="nav-link" aria-current="page" href="dashboardStoricoOrdini.html"> <i class="bi bi-box-seam-fill me-2"></i>I MIEI ORDINI
                             </a>
                        </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#"> <i class="bi bi-flag-fill me-2"></i>LE MIE SEGNALAZIONI
                                </a>
                            </li>
                            </ul>
                        <hr class="sidebar-divider">
                        <a href="logout.html">
                            <button class="btn logout-btn w-100">
                                <i class="bi bi-box-arrow-right me-2"></i>LOGOUT
                            </button>
                        </a>
                    </div>
                </div>
            </div>
           <ul class="nav nav-pills align-items-center"> <!-- Rimosso ms-auto qui, lo gestisce justify-content-between -->
                <li class="nav-item"> <!-- Aggiunto ms-auto all'ul per spingerlo a destra -->
                    <a href="carrelloUtente.html" class="nav-link nav-link-cart invisible">
                        <i class="bi bi-cart fs-3"></i>
                    </a>
                    <a href="login.html" class="nav-link nav-link-cart unlogged">
                        <i class="bi bi-cart fs-3"></i>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <main class="container my-4 pt-lg-0">
        <div class="row mb-3">
            <div class="col">
                <a href="dettaglioProdotto.html" class="back-to-search-link">
                    <i class="bi bi-arrow-left-circle me-1"></i>
                    Indietro
                </a>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-4 col-md-5 mb-4 mb-md-0">
                <div class="artisan-info-box">
                    <h3 id="nomeArtigiano" class="artisan-name">Nome Artigiano Esempio</h3>
                    <p id="indirizzoArtigiano" class="artisan-address">Via Roma, 123 - 00100 Città (RM)</p>
                    <hr>
                    <h5 class="description-label">Descrizione</h5>
                    <div id="descArtigiano" class="artisan-description-content">
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
                        <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
                    </div>
                </div>
            </div>

            <div class="col-lg-8 col-md-7">
                <h2 class="products-available-title mb-3">Prodotti Disponibili</h2>
                <div id="artisan-products" class="row row-cols-1 row-cols-sm-2 row-cols-xl-3 g-4">
                    <div class="col">
                        <div class="card h-100 product-card-artisan">
                            <a href="dettaglioProdotto.html" class="text-decoration-none text-dark">
                                <div class="product-image-placeholder d-flex align-items-center justify-content-center">IMG</div>
                            </a>
                            <div class="card-body d-flex flex-column">
                                <ul class="list-unstyled mt-2 mb-auto product-info-list">
                                    <li class="product-name-list-item">Nome Prodotto A</li>
                                    <li class="product-rating-list-item">
                                        Valutazione:
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-half star-icon"></i>
                                        <i class="bi bi-star star-icon"></i>
                                    </li>
                                    <li class="product-price-list-item">Prezzo: €25.00</li>
                                </ul>
                                
                                <!-- UNLOGGED -->
                                
                                <a href="login.html" class="nav-link unlogged" style="color: var(--secondary-color);">
                                    <i class="bi bi-cart fs-4"></i>
                                </a>

                                <!-- LOGGED (aggiunge il prodotto al carrello)-->
                                <button class="btn btn-sm mt-3 add-to-cart-button-artisan invisible">
                                     <i class="bi bi-cart-plus"></i> Aggiungi al Carrello
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card h-100 product-card-artisan">
                            <a href="dettaglioProdotto.html" class="text-decoration-none text-dark">
                                <div class="product-image-placeholder d-flex align-items-center justify-content-center">IMG</div>
                            </a>
                            <div class="card-body d-flex flex-column">
                                <ul class="list-unstyled mt-2 mb-auto product-info-list">
                                    <li class="product-name-list-item">Nome Prodotto B</li>
                                    <li class="product-rating-list-item">
                                        Valutazione:
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star star-icon"></i>
                                    </li>
                                    <li class="product-price-list-item">Prezzo: €30.50</li>
                                </ul>
                                <button class="btn btn-sm mt-3 add-to-cart-button-artisan">
                                     <i class="bi bi-cart-plus"></i> Aggiungi al Carrello
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                         <div class="card h-100 product-card-artisan">
                            <a href="dettaglioProdotto.html" class="text-decoration-none text-dark">
                                <div class="product-image-placeholder d-flex align-items-center justify-content-center">IMG</div>
                            </a>
                            <div class="card-body d-flex flex-column">
                                <ul class="list-unstyled mt-2 mb-auto product-info-list">
                                    <li class="product-name-list-item">Nome Prodotto C</li>
                                    <li class="product-rating-list-item">
                                        Valutazione:
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-fill star-icon"></i>
                                        <i class="bi bi-star-half star-icon"></i>
                                        <i class="bi bi-star star-icon"></i>
                                        <i class="bi bi-star star-icon"></i>
                                    </li>
                                    <li class="product-price-list-item">Prezzo: €19.99</li>
                                </ul>
                                <button class="btn btn-sm mt-3 add-to-cart-button-artisan">
                                     <i class="bi bi-cart-plus"></i> Aggiungi al Carrello
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/fetcher.js"></script>
    <script>
        function showProducts(result){
            let productsRes = ``;
                const products = result.data.map((product) => {
                    productsRes += (
                        `<div class="col">
                            <div class="card h-100 product-card-artisan">
                                <a href="dettaglioProdotto.html?id=${product.idprodotto}" class="text-decoration-none text-dark">
                                    <div class="product-image-placeholder d-flex align-items-center justify-content-center"><img href="${product.immagine_url}" /></div>
                                </a>
                                <div class="card-body d-flex flex-column">
                                    <ul class="list-unstyled mt-2 mb-auto product-info-list">
                                        <li class="product-name-list-item"${product.nome}</li>
                                        <li class="product-rating-list-item">
                                            Valutazione:
                                            <i class="bi bi-star-fill star-icon"></i>
                                            <i class="bi bi-star-fill star-icon"></i>
                                            <i class="bi bi-star-fill star-icon"></i>
                                            <i class="bi bi-star-half star-icon"></i>
                                            <i class="bi bi-star star-icon"></i>
                                        </li>
                                        <li class="product-price-list-item">Prezzo: €${product.prezzounitario}</li>
                                    </ul>
                                    
                                    <!-- UNLOGGED -->
                                    
                                    <a href="login.html" class="nav-link unlogged" style="color: var(--secondary-color);">
                                        <i class="bi bi-cart fs-4"></i>
                                    </a>

                                    <!-- LOGGED (aggiunge il prodotto al carrello)-->
                                    <button class="btn btn-sm mt-3 add-to-cart-button-artisan invisible">
                                        <i class="bi bi-cart-plus"></i> Aggiungi al Carrello
                                    </button>
                                </div>
                            </div>
                        </div>`
                    )
                });


                document.getElementById("artisan-products").innerHTML = productsRes;
        }

        document.addEventListener("DOMContentLoaded", async function(){

            const urlParams = new URLSearchParams(window.location.search);
            id = urlParams.get('id');

            let result = await fetchData(`/api/users/${id}`, "GET");
            console.log(result);
            if(result.status == 200){
                document.getElementById("nomeArtigiano").textContent = result.data.username;
                document.getElementById("indirizzoArtigiano").textContent = result.data.indirizzo;
                document.getElementById("descArtigiano").textContent = result.data.artigianodescrizione;
            }else{
                console.log("Errore caricamento dati!")
            }

            let productsReq = await fetchData(`/api/products/notdeleted?idartigiano=${id}`, "GET");
            console.log(productsReq);
            if(result.status == 200){
                showProducts(productsReq);

            }else{
                console.log("Errore caricamento prodotti!")
            }

            let info = await fetchData("/api/auth/session-info", "GET");
                if(info.status == 200){
                    const selectorInvisible = document.querySelectorAll('.invisible');
                    selectorInvisible.forEach(section => {
                        if(info.data.tipologia != "Admin")
                        section.classList.remove("invisible")
                        section.classList.add("logged")
                    });

                    const selectorUnlogged = document.querySelectorAll('.unlogged');
                    selectorUnlogged.forEach(section => {
                        section.classList.add("invisible");
                    });
                    
                    if(info.data.tipologia == "Admin"){
                        const selectorAdmin = document.querySelectorAll('.invisible-admin');
                        selectorAdmin.forEach(section => {
                            section.classList.remove("invisible-admin");
                        });
                }
            }
        })
    </script>
    <script src="js/headerShower.js"></script>
</body>
</html>
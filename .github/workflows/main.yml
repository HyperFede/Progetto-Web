name: CI with e2e

on:
  push:    { branches: [ main ] }
  pull_request: { branches: [ main ] }

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with: { node-version: "18" }

      - name: Install dependencies
        run: npm install

      # 1) Build your app (if you have a build step)
      - name: Build
        run: npm run build     # or skip if no build

      # 2) Start your server in the background
      - name: Start server
        run: npm start &
      
      # 3) Wait for it to be up
      - name: Wait for server
        uses: jakejarvis/wait-on-action@v1
        with:
          url: http://localhost:3000   # adjust as needed

      # 4) Run your e2e tests
      - name: Run end-to-end tests
        run: npm test                # now this can be real tests against your live app
